(()=>{var t={878:(t,e,s)=>{const i=s(19),{withAutomaticRetries:n}=s(438),r=s(466),a=s(107),o=s(873),c=s(188),h=s(473),u=s(973);t.exports=class{constructor(t={}){this.auth=t.auth||process.env.REPLICATE_API_TOKEN,this.userAgent=t.userAgent||`replicate-javascript/${u.version}`,this.baseUrl=t.baseUrl||"https://api.replicate.com/v1",this.fetch=t.fetch||globalThis.fetch,this.collections={list:r.list.bind(this),get:r.get.bind(this)},this.models={get:o.get.bind(this),list:o.list.bind(this),versions:{list:o.versions.list.bind(this),get:o.versions.get.bind(this)}},this.predictions={create:c.create.bind(this),get:c.get.bind(this),cancel:c.cancel.bind(this),list:c.list.bind(this)},this.trainings={create:h.create.bind(this),get:h.get.bind(this),cancel:h.cancel.bind(this),list:h.list.bind(this)},this.deployments={predictions:{create:a.predictions.create.bind(this)}}}async run(t,e,s){const{wait:i,...n}=e,r=/[a-zA-Z0-9]+(?:(?:[._]|__|[-]*)[a-zA-Z0-9]+)*/,a=new RegExp(`^(?<owner>${r.source})/(?<name>${r.source}):(?<version>[0-9a-fA-F]+)$`),o=t.match(a);if(!o||!o.groups)throw new Error('Invalid version. It must be in the format "owner/name:version"');const{version:c}=o.groups;let h=await this.predictions.create({...n,version:c});s&&s(h);const{signal:u}=e;if(h=await this.wait(h,i||{},(async t=>(s&&s(t),!(!u||!u.aborted||(await this.predictions.cancel(t.id),0))))),s&&s(h),"failed"===h.status)throw new Error(`Prediction failed: ${h.error}`);return h.output}async request(t,e){const{auth:s,baseUrl:r,userAgent:a}=this;let o;o=t instanceof URL?t:new URL(t.startsWith("/")?t.slice(1):t,r.endsWith("/")?r:`${r}/`);const{method:c="GET",params:h={},data:u}=e;Object.entries(h).forEach((([t,e])=>{o.searchParams.append(t,e)}));const d=new Headers;s&&d.append("Authorization",`Token ${s}`),d.append("Content-Type","application/json"),d.append("User-Agent",a),e.headers&&e.headers.forEach(((t,e)=>{d.append(e,t)}));const l={method:c,headers:d,body:u?JSON.stringify(u):void 0},p="GET"===c?t=>429===t.status||t.status>=500:t=>429===t.status,w=this.fetch,m=await n((async()=>w(o,l)),{shouldRetry:p});if(!m.ok){const t=new Request(o,l),e=await m.text();throw new i(`Request to ${o} failed with status ${m.status} ${m.statusText}: ${e}.`,t,m)}return m}async*paginate(t){const e=await t();if(yield e.results,e.next){const t=()=>this.request(e.next,{method:"GET"}).then((t=>t.json()));yield*this.paginate(t)}}async wait(t,e,s){const{id:i}=t;if(!i)throw new Error("Invalid prediction");if("succeeded"===t.status||"failed"===t.status||"canceled"===t.status)return t;const n=t=>new Promise((e=>setTimeout(e,t))),r=e&&e.interval||500;let a=await this.predictions.get(i);for(;"succeeded"!==a.status&&"failed"!==a.status&&"canceled"!==a.status&&(!s||!0!==await s(a));)await n(r),a=await this.predictions.get(t.id);if("failed"===a.status)throw new Error(`Prediction failed: ${a.error}`);return a}}},466:t=>{t.exports={get:async function(t){return(await this.request(`/collections/${t}`,{method:"GET"})).json()},list:async function(){return(await this.request("/collections",{method:"GET"})).json()}}},107:t=>{t.exports={predictions:{create:async function(t,e,s){const{stream:i,...n}=s;if(n.webhook)try{new URL(n.webhook)}catch(t){throw new Error("Invalid webhook URL")}return(await this.request(`/deployments/${t}/${e}/predictions`,{method:"POST",data:{...n,stream:i}})).json()}}}},19:t=>{class e extends Error{constructor(t,e,s){super(t),this.name="ApiError",this.request=e,this.response=s}}t.exports=e},873:t=>{t.exports={get:async function(t,e){return(await this.request(`/models/${t}/${e}`,{method:"GET"})).json()},list:async function(){return(await this.request("/models",{method:"GET"})).json()},versions:{list:async function(t,e){return(await this.request(`/models/${t}/${e}/versions`,{method:"GET"})).json()},get:async function(t,e,s){return(await this.request(`/models/${t}/${e}/versions/${s}`,{method:"GET"})).json()}}}},188:t=>{t.exports={create:async function(t){const{stream:e,...s}=t;if(s.webhook)try{new URL(s.webhook)}catch(t){throw new Error("Invalid webhook URL")}return(await this.request("/predictions",{method:"POST",data:{...s,stream:e}})).json()},get:async function(t){return(await this.request(`/predictions/${t}`,{method:"GET"})).json()},cancel:async function(t){return(await this.request(`/predictions/${t}/cancel`,{method:"POST"})).json()},list:async function(){return(await this.request("/predictions",{method:"GET"})).json()}}},473:t=>{t.exports={create:async function(t,e,s,i){const{...n}=i;if(n.webhook)try{new URL(n.webhook)}catch(t){throw new Error("Invalid webhook URL")}return(await this.request(`/models/${t}/${e}/versions/${s}/trainings`,{method:"POST",data:n})).json()},get:async function(t){return(await this.request(`/trainings/${t}`,{method:"GET"})).json()},cancel:async function(t){return(await this.request(`/trainings/${t}/cancel`,{method:"POST"})).json()},list:async function(){return(await this.request("/trainings",{method:"GET"})).json()}}},438:(t,e,s)=>{const i=s(19);t.exports={withAutomaticRetries:async function(t,e={}){const s=e.shouldRetry||(()=>!1),n=e.maxRetries||5,r=e.interval||500,a=e.jitter||100,o=t=>new Promise((e=>setTimeout(e,t)));let c=0;do{let h=r*2**c+Math.random()*a;try{const e=await t();if(e.ok||!s(e))return e}catch(t){if(t instanceof i){const e=t.response.headers.get("Retry-After");if(e)if(Number.isInteger(e))h=1e3*e;else{const t=new Date(e);Number.isNaN(t.getTime())||(h=t.getTime()-(new Date).getTime())}}}Number.isInteger(n)&&n>0&&(Number.isInteger(h)&&h>0&&await o(r*2**(e.maxRetries-n)),c+=1)}while(c<n);return t()}}},973:t=>{"use strict";t.exports=JSON.parse('{"name":"replicate","version":"0.20.1","description":"JavaScript client for Replicate","repository":"github:replicate/replicate-javascript","homepage":"https://github.com/replicate/replicate-javascript#readme","bugs":"https://github.com/replicate/replicate-javascript/issues","license":"Apache-2.0","main":"index.js","engines":{"node":">=18.0.0","npm":">=7.19.0","git":">=2.11.0","yarn":">=1.7.0"},"scripts":{"check":"tsc","lint":"eslint .","test":"jest"},"devDependencies":{"@types/jest":"^29.5.3","@typescript-eslint/eslint-plugin":"^5.56.0","cross-fetch":"^3.1.5","eslint":"^8.36.0","eslint-config-airbnb-base":"^15.0.0","eslint-plugin-import":"^2.27.5","eslint-plugin-jest":"^27.2.1","eslint-plugin-jsdoc":"^46.2.6","eslint-plugin-n":"^15.6.1","eslint-plugin-promise":"^6.1.1","jest":"^29.6.2","nock":"^13.3.0","ts-jest":"^29.1.0","typescript":"^5.0.2"}}')}},e={};function s(i){var n=e[i];if(void 0!==n)return n.exports;var r=e[i]={exports:{}};return t[i](r,r.exports,s),r.exports}(()=>{const t=new(s(878))({auth:"r8_c9Zyab1TtF8l60uN04WymVaW79LiKgh3MXx0L"});(async()=>{const e=await t.run("stability-ai/stable-diffusion:f178fa7a1ae43a9a9af01b833b9d2ecf97b1bcb0acfd2dc5dd04895e042863f1",{input:{prompt:"a photo of an astronaut riding a horse on mars"}});console.log(e)})()})()})();